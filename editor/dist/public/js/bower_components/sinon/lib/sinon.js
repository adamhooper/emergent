/**
 * Sinon core utilities. For internal use only.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2013 Christian Johansen
 */

var sinon=function(e){function r(e){var n=!1;try{e.appendChild(t),n=t.parentNode==e}catch(r){return!1}finally{try{e.removeChild(t)}catch(r){}}return n}function i(e){return t&&e&&e.nodeType===1&&r(e)}function s(e){return typeof e=="function"||!!(e&&e.constructor&&e.call&&e.apply)}function o(e){return typeof e=="number"&&isNaN(e)}function u(e,t){for(var r in t)n.call(e,r)||(e[r]=t[r])}function a(e){return typeof e=="function"&&typeof e.restore=="function"&&e.restore.sinon}function h(e,t,n){n.exports=f,f.spy=e("./sinon/spy"),f.spyCall=e("./sinon/call"),f.behavior=e("./sinon/behavior"),f.stub=e("./sinon/stub"),f.mock=e("./sinon/mock"),f.collection=e("./sinon/collection"),f.assert=e("./sinon/assert"),f.sandbox=e("./sinon/sandbox"),f.test=e("./sinon/test"),f.testCase=e("./sinon/test_case"),f.match=e("./sinon/match")}var t=typeof document!="undefined"&&document.createElement("div"),n=Object.prototype.hasOwnProperty,f={wrapMethod:function(t,r,i){if(!t)throw new TypeError("Should wrap property of object");if(typeof i!="function")throw new TypeError("Method wrapper should be function");var o=t[r],a;if(!s(o))a=new TypeError("Attempted to wrap "+typeof o+" property "+r+" as function");else if(o.restore&&o.restore.sinon)a=new TypeError("Attempted to wrap "+r+" which is already wrapped");else if(o.calledBefore){var f=o.returns?"stubbed":"spied on";a=new TypeError("Attempted to wrap "+r+" which is already "+f)}if(a)throw o&&o._stack&&(a.stack+="\n--------------\n"+o._stack),a;var l=t.hasOwnProperty?t.hasOwnProperty(r):n.call(t,r);return t[r]=i,i.displayName=r,i._stack=(new Error("Stack Trace for original")).stack,i.restore=function(){l||delete t[r],t[r]===i&&(t[r]=o)},i.restore.sinon=!0,u(i,o),i},extend:function(t){for(var n=1,r=arguments.length;n<r;n+=1)for(var i in arguments[n])arguments[n].hasOwnProperty(i)&&(t[i]=arguments[n][i]),arguments[n].hasOwnProperty("toString")&&arguments[n].toString!=t.toString&&(t.toString=arguments[n].toString);return t},create:function(t){var n=function(){};return n.prototype=t,new n},deepEqual:function m(e,t){if(f.match&&f.match.isMatcher(e))return e.test(t);if(typeof e!="object"||typeof t!="object")return o(e)&&o(t)?!0:e===t;if(i(e)||i(t))return e===t;if(e===t)return!0;if(e===null&&t!==null||e!==null&&t===null)return!1;if(e instanceof RegExp&&t instanceof RegExp)return e.source===t.source&&e.global===t.global&&e.ignoreCase===t.ignoreCase&&e.multiline===t.multiline;var n=Object.prototype.toString.call(e);if(n!=Object.prototype.toString.call(t))return!1;if(n=="[object Date]")return e.valueOf()===t.valueOf();var r,s=0,u=0;if(n=="[object Array]"&&e.length!==t.length)return!1;for(r in e){s+=1;if(!(r in t))return!1;if(!m(e[r],t[r]))return!1}for(r in t)u+=1;return s==u},functionName:function(t){var n=t.displayName||t.name;if(!n){var r=t.toString().match(/function ([^\s\(]+)/);n=r&&r[1]}return n},functionToString:function g(){if(this.getCall&&this.callCount){var e,t,n=this.callCount;while(n--){e=this.getCall(n).thisValue;for(t in e)if(e[t]===this)return t}}return this.displayName||"sinon fake"},getConfig:function(e){var t={};e=e||{};var n=f.defaultConfig;for(var r in n)n.hasOwnProperty(r)&&(t[r]=e.hasOwnProperty(r)?e[r]:n[r]);return t},format:function(e){return""+e},defaultConfig:{injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},timesInWords:function(t){return t==1&&"once"||t==2&&"twice"||t==3&&"thrice"||(t||0)+" times"},calledInOrder:function(e){for(var t=1,n=e.length;t<n;t++)if(!e[t-1].calledBefore(e[t])||!e[t].called)return!1;return!0},orderByFirstCall:function(e){return e.sort(function(e,t){var n=e.getCall(0),r=t.getCall(0),i=n&&n.callId||-1,s=r&&r.callId||-1;return i<s?-1:1})},log:function(){},logError:function(e,t){var n=e+" threw exception: ";f.log(n+"["+t.name+"] "+t.message),t.stack&&f.log(t.stack),setTimeout(function(){throw t.message=n+t.message,t},0)},typeOf:function(e){if(e===null)return"null";if(e===undefined)return"undefined";var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()},createStubInstance:function(e){if(typeof e!="function")throw new TypeError("The constructor should be a function.");return f.stub(f.create(e.prototype))},restore:function(e){if(e!==null&&typeof e=="object")for(var t in e)a(e[t])&&e[t].restore();else a(e)&&e.restore()}},l=typeof module!="undefined"&&module.exports,c=typeof define=="function"&&typeof define.amd=="object"&&define.amd;if(c)define(h);else if(l){try{e=require("formatio")}catch(p){}h(require,exports,module)}if(e){var d=e.configure({quoteStrings:!1});f.format=function(){return d.ascii.apply(d,arguments)}}else if(l)try{var v=require("util");f.format=function(e){return typeof e=="object"&&e.toString===Object.prototype.toString?v.inspect(e):e}}catch(p){}return f}(typeof formatio=="object"&&formatio);